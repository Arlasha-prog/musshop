{% extends "base.html" %}
{% load static %}

{% block title %}Корзина — MusShop{% endblock %}

{% block extra_css %}
<style>
  .btn-cart {
    display:inline-block; background:#28a745; color:#fff; border:none;
    padding:10px 18px; border-radius:999px; font-weight:600; cursor:pointer;
  }
  .btn-cart:hover { opacity:.9; }
  @media (max-width: 576px){ .btn, .btn-cart { width:100%; } }
  .table td, .table th { vertical-align: middle; }
  tfoot th { font-weight: 700; }
  .empty-note { color:#666; }
  .cart-actions { gap:.5rem; flex-wrap:wrap; }
}
</style>
{% endblock %}

{% block page_heading %}
<div class="page-heading header-text">
  <div class="container">
    <div class="row"><div class="col-lg-12">
      <h3>Корзина</h3>
    </div></div>
  </div>
  </div>
{% endblock %}

{% block content %}
{% if items %}
  <div class="table-responsive">
    <table class="table align-middle">
      <thead>
        <tr>
          <th>Товар</th>
          <th class="text-center">Кол-во</th>
          <th class="text-end">Цена</th>
          <th class="text-end">Сумма</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
      {% for item in items %}
        <tr>
          <td>
            <a href="{% url 'product' item.product.slug %}">{{ item.product.title }}</a>
          </td>
          <td class="text-center">{{ item.quantity }}</td>
          <td class="text-end">{{ item.price|floatformat:0 }} ₸</td>
          <td class="text-end">{{ item.total_price|floatformat:0 }} ₸</td>
          <td class="text-end">
            <form method="post" action="{% url 'cart_remove' item.product.slug %}">
              {% csrf_token %}
              <button class="btn btn-sm btn-outline-danger" type="submit">Удалить</button>
            </form>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="d-flex justify-content-between align-items-center mt-3">
    <div><strong>Всего позиций:</strong> {{ total_qty }}</div>
    <div style="font-size:20px;"><strong>Итого:</strong> {{ total_price|floatformat:0 }} ₸</div>
  </div>

  <div class="mt-3 d-flex cart-actions">
    <a href="{% url 'shop_all' %}" class="btn btn-outline-secondary">Продолжить покупки</a>
    <form method="post" action="{% url 'cart_clear' %}">
      {% csrf_token %}
      <button class="btn btn-outline-warning" type="submit">Очистить корзину</button>
    </form>
    <a href="{% url 'orders:create' %}" class="btn-cart">Оформить заказ</a>
  </div>
{% else %}
  <p class="empty-note">Ваша корзина пуста.</p>
  <a href="{% url 'shop_all' %}" class="btn btn-primary mt-2">Перейти в каталог</a>
{% endif %}
{% endblock %}
